# [212_4] 修复可编辑PDF导出的crash问题

## 如何测试
使用 Mogan 打开 DevTeam/软件测试文件/main_en.tmu，文件->导出->可编辑PDF，查看软件是否会崩溃

## 2026/02/27 
可编辑PDF的导出会使用src/Plugins/Pdf/pdf_hummus_extract_attachment.cpp中的get_linked_file_paths函数，这个函数会对image节点做特殊的处理。
```C++
array<url>
get_linked_file_paths (tree t, url path) {
  array<url> tm_and_linked_file;
  string     label= get_label (t);
  if (label == "image" || label == "include") {
    url incl_url= get_url_image_or_include_tree (t, path);
    if (!is_none (incl_url)) tm_and_linked_file << incl_url;
    return tm_and_linked_file;
  }
  if (label == "style") return get_url_style_tree (t, path);
  if (!is_atomic (t))
    for (int i= 0; i < N (t); i++)
      tm_and_linked_file << get_linked_file_paths (t[i], path);
  return tm_and_linked_file;
}
```
但是函数中对image的判断并不严谨，在出现问题的文件中发现了这样的片段 <tree|<verbatim|figure>|image>，而这个函数将其中的image文本判断为image节点，并调用get_url_image_or_include_tree试图访问t[0]，造成了越界

因此，添加了更严格的判断：
```C++
!is_atomic (t) && N (t) > 0 && (label == "image" || label == "include"
```
并在函数get_url_image_or_include_tree中添加保护：
```C++
if (is_atomic (t) || N (t) == 0) return url_none ();
```
在同一个文件中的另一个函数replace_with_relative_path发现了同样的判断，在此一并修改。
