# [222_42] 软件启动时不打开“无标题文件”

## 如何测试

打包并安装Mogan，进行以下测试：

+ 安装后，直接启动Mogan，应只有一个欢迎文档标签页
+ 删除缓存，直接启动Mogan，应只有一个欢迎文档标签页
+ 删除缓存，从文件打开Mogan，应有一个文件标签页和一个欢迎文档标签页
+ 不删除缓存，从文件打开Mogan，应只有一个文件标签页

## 2026/02/13 软件启动时不打开“无标题文件”

### What

由 Mogan 的启动入口 init_texmacs.cpp 可知，出现无标题标签页的原因是 Mogan 启动需要至少一个window，而 window 必须使用一个 buffer 创建，因此之前的逻辑中使用无标题文件进行占位，使软件在没有文件被打开的情况下也可以正常启动。

因此，若不想出现无标题文件，就需要另外的 buffer 用于加载 window ，具体可以分为以下情况：

+ 直接启动软件，使用欢迎文档加载 buffer
+ 从文件启动软件，使用目标文件加载 buffer

另外，在软件更新后的首次启动，以及用户首次安装启动的情况下，需要额外打开欢迎文档。

### How

做出以下修改：

+ new_buffer.cpp 中新增 make_welcome_buffer() 函数，用于将对应语言的欢迎文档加载为 buffer
+ new_window.cpp 中新增 ensure_window() 函数，用于确保直接启动软件时有至少一个 window 存在
+ init_texmacs.cpp 中，修改从文件启动的行为，仅**第一个文件**调用 buffer_load() 与 new_buffer_in_new_window() ，使用文件加载一个 buffer，并从这个 buffer 创建一个新的 window。
+ init_texmacs.cpp 中，创建两个 flag，分别表示是否从文件启动、是否首次启动/更新后首次启动，若都不是，则调用 ensure_window() ，确保软件可以正常启动。